

<script type="module">
    
    import { MyPromise } from './Promise.js'
    
    // console.log(MyPromise)

    const getFinishedPromiseWithDelay = (delay, isResolved, data = 'some success DATA.', err = 'can\'t find.') => {
        return new MyPromise((resolve, reject) => {
            setTimeout(function(){
                // 如果未定义是否resolved，就随机。
                if(isResolved === undefined){
                    isResolved = Date.now() % 2
                }
                isResolved ? resolve(data) : reject(err)
            }, delay)
        })
    }

    // then比resolve先到(大多数场景)：
    let p1 = getFinishedPromiseWithDelay(1000, true)
    .then( d => {
        console.log('p1:', d, p1)
        return '1111111111'
    })
    .then( d => {
        console.log('p1:', d, p1)
        return '22222222222'
    })

    // resolve比then先到
    let p2 = getFinishedPromiseWithDelay(100, true)
    setTimeout(()=>{
        p2.then(d => console.log('p2:', d, p2))
    }, 500)

    // 每个then都返回新的promise
    let p3 = getFinishedPromiseWithDelay(1e3, true, {a:'AAA'})
    let p4 = getFinishedPromiseWithDelay(1.5e3, true, {b:'BBB'})
    console.log(p3, p4)


    // p
    // .then(data => {
    //     console.log('success:', data)
    // }).catch(e => {
    //     console.log('error:', e)
    // })

    // console.log(MyPromise.resolve({n:'Success'}))
    // setTimeout(()=>{
    //     p.then(d=>console.info('......', d))
    // }, 3000)

    // console.log(p)

    // 方便在console上查看promise的值
    function extend(a, b){ for(let k in b){ a[k] = b[k] } }
    extend(window, {p1, p2, p3, p4})
</script>
